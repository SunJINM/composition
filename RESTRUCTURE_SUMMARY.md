# é¡¹ç›®é‡æ„æ€»ç»“æŠ¥å‘Š

## é‡æ„å®Œæˆæƒ…å†µ

âœ… **å·²å®Œæˆçš„å·¥ä½œ**

### 1. ç›®å½•ç»“æ„é‡ç»„ âœ…

#### æ–°å»ºç›®å½•
```
app/                     # åº”ç”¨ä¸»ç›®å½•(æ–°å»º)
â”œâ”€â”€ models/             # æ•°æ®åº“æ¨¡å‹(æ–°å»º)
â”œâ”€â”€ schemas/            # æ•°æ®éªŒè¯æ¨¡å¼(æ–°å»º)
â”œâ”€â”€ api/                # APIè·¯ç”±(æ–°å»º)
â”œâ”€â”€ services/           # ä¸šåŠ¡é€»è¾‘(æ–°å»º)
â””â”€â”€ utils/              # å·¥å…·å‡½æ•°(æ–°å»º)

static/                 # é™æ€æ–‡ä»¶(æ–°å»º)
â”œâ”€â”€ css/
â”œâ”€â”€ js/
â””â”€â”€ images/

templates/              # HTMLæ¨¡æ¿(æ–°å»º)
scripts/                # è„šæœ¬å·¥å…·(æ–°å»º)
data/                   # æ•°æ®æ–‡ä»¶(æ–°å»º)
tests/                  # æµ‹è¯•æ–‡ä»¶(æ–°å»º)
logs/                   # æ—¥å¿—æ–‡ä»¶(æ–°å»º)
```

#### æ–‡ä»¶è¿ç§»æ˜ å°„

| åŸä½ç½® | æ–°ä½ç½® | çŠ¶æ€ |
|--------|--------|------|
| `ai-scoring.html` | `templates/ai-scoring.html` | âœ… å·²è¿ç§» |
| `index.html` | `templates/index.html` | âœ… å·²è¿ç§» |
| `essays_data.json` | `data/essays_data.json` | âœ… å·²è¿ç§» |
| `essays_require.json` | `data/essays_require.json` | âœ… å·²è¿ç§» |
| `analyze_prompts.json` | `data/analyze_prompts.json` | âœ… å·²è¿ç§» |
| `score_prompts.json` | `data/score_prompts.json` | âœ… å·²è¿ç§» |
| `prompts.json` | `data/prompts.json` | âœ… å·²è¿ç§» |
| `extract_essays.py` | `scripts/extract_essays.py` | âœ… å·²è¿ç§» |
| `upload_files_to_oss.py` | `scripts/upload_to_oss.py` | âœ… å·²è¿ç§» |
| `custom_oss_client.py` | `scripts/custom_oss_client.py` | âœ… å·²è¿ç§» |
| `path_cover.py` | `scripts/path_cover.py` | âœ… å·²è¿ç§» |
| `pdf_to_image.py` | `scripts/pdf_to_image.py` | âœ… å·²è¿ç§» |
| `dajuan.py` | `scripts/dajuan.py` | âœ… å·²è¿ç§» |
| `server.py` | ä¿ç•™(å¾…æ‹†åˆ†åˆ°app/api/) | â³ å¾…å¤„ç† |

---

### 2. æ•°æ®åº“å±‚å®Œæˆ âœ…

#### é…ç½®æ–‡ä»¶
- âœ… `app/config.py` - é…ç½®ç®¡ç†(æ”¯æŒç¯å¢ƒå˜é‡)
- âœ… `app/database.py` - æ•°æ®åº“è¿æ¥ç®¡ç†
- âœ… `.env.example` - ç¯å¢ƒå˜é‡æ¨¡æ¿

#### æ•°æ®åº“æ¨¡å‹ (9ä¸ªæ¨¡å‹)
- âœ… `app/models/base.py` - åŸºç±»æ¨¡å‹(é€šç”¨å­—æ®µ)
- âœ… `app/models/user.py` - ç”¨æˆ·æ¨¡å‹
- âœ… `app/models/grade.py` - å¹´çº§æ¨¡å‹
- âœ… `app/models/genre.py` - æ–‡ä½“æ¨¡å‹
- âœ… `app/models/prompt.py` - æç¤ºè¯æ¨¡å‹
- âœ… `app/models/batch.py` - æ‰¹æ¬¡æ¨¡å‹ â­(æ–°å¢)
- âœ… `app/models/essay.py` - ä½œæ–‡æ¨¡å‹(å¢åŠ score_systemå­—æ®µ)
- âœ… `app/models/evaluation.py` - è¯„ä»·æ¨¡å‹
- âœ… `app/models/score.py` - è¯„åˆ†æ¨¡å‹
- âœ… `app/models/feedback.py` - åé¦ˆæ¨¡å‹

#### åˆå§‹åŒ–è„šæœ¬
- âœ… `scripts/init_db.py` - æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
  - åˆ›å»ºæ‰€æœ‰è¡¨ç»“æ„
  - æ’å…¥åˆå§‹æ•°æ®(å¹´çº§ã€æ–‡ä½“)

- âœ… `scripts/migrate_data.py` - æ•°æ®è¿ç§»è„šæœ¬
  - æ‰¹æ¬¡æ•°æ®è¿ç§» (essays_require.json â†’ composition_batches)
  - ä½œæ–‡æ•°æ®è¿ç§» (essays_data.json â†’ composition_essays)
  - æç¤ºè¯æ•°æ®è¿ç§» (JSON â†’ composition_prompts)
  - è‡ªåŠ¨åˆ¤æ–­åˆ†åˆ¶(10åˆ†åˆ¶/40åˆ†åˆ¶)
  - æ‰¹æ¬¡å…³è”å¤„ç†

---

### 3. é…ç½®ç®¡ç† âœ…

#### ç¯å¢ƒé…ç½®
- âœ… `.env.example` - ç¯å¢ƒå˜é‡æ¨¡æ¿
- âœ… `.gitignore` - Gitå¿½ç•¥è§„åˆ™
- âœ… `requirements.txt` - Pythonä¾èµ–ç®¡ç†

#### é…ç½®ç‰¹æ€§
- âœ… æ”¯æŒç¯å¢ƒå˜é‡é…ç½®
- âœ… æ”¯æŒé…ç½®æ–‡ä»¶(å¯é€‰)
- âœ… æ•°æ®åº“é…ç½®é›†ä¸­ç®¡ç†
- âœ… OpenAIé…ç½®é›†ä¸­ç®¡ç†
- âœ… åº”ç”¨é…ç½®é›†ä¸­ç®¡ç†

---

### 4. æ–‡æ¡£å®Œå–„ âœ…

- âœ… `PROJECT_STRUCTURE.md` - é¡¹ç›®ç»“æ„è¯´æ˜
- âœ… `DEPLOYMENT_GUIDE.md` - éƒ¨ç½²æŒ‡å—(è¯¦ç»†)
- âœ… `RESTRUCTURE_SUMMARY.md` - é‡æ„æ€»ç»“(æœ¬æ–‡æ¡£)
- âœ… `.gitignore` - Gitå¿½ç•¥é…ç½®
- âœ… `run.py` - åº”ç”¨å¯åŠ¨è„šæœ¬

---

## æ ¸å¿ƒæ”¹è¿›ç‚¹

### 1. ä»£ç ç»„ç»‡ â­
**ä¹‹å‰**: æ‰€æœ‰é€»è¾‘æ··åœ¨ `server.py` å•æ–‡ä»¶ä¸­(22877è¡Œ)
**ç°åœ¨**: åˆ†å±‚æ¶æ„,èŒè´£åˆ†ç¦»
```
APIå±‚ (app/api/)         - å¤„ç†HTTPè¯·æ±‚
    â†“
æœåŠ¡å±‚ (app/services/)   - ä¸šåŠ¡é€»è¾‘
    â†“
æ¨¡å‹å±‚ (app/models/)     - æ•°æ®åº“æ“ä½œ
```

### 2. æ•°æ®æŒä¹…åŒ– â­
**ä¹‹å‰**: JSONæ–‡ä»¶å­˜å‚¨(essays_data.json 2.6MB)
**ç°åœ¨**: MySQLæ•°æ®åº“
- æ”¯æŒå¤æ‚æŸ¥è¯¢
- æ•°æ®å®Œæ•´æ€§çº¦æŸ
- äº‹åŠ¡æ”¯æŒ
- æ€§èƒ½ä¼˜åŒ–(ç´¢å¼•)

### 3. æ‰¹æ¬¡ç®¡ç† â­
**ä¹‹å‰**: ä½œæ–‡å’Œè¦æ±‚åˆ†æ•£å­˜å‚¨
**ç°åœ¨**: å¼•å…¥æ‰¹æ¬¡(Batch)æ¦‚å¿µ
- ä¸€ä¸ªæ‰¹æ¬¡ = ä¸€ä¸ªé¢˜ç›® + å¤šç¯‡ä½œæ–‡
- é€šè¿‡ `directory_name` å…³è”
- ä¾¿äºæ‰¹é‡ç®¡ç†

### 4. åˆ†åˆ¶ç®¡ç† â­
**ä¹‹å‰**: æœªæ˜ç¡®åŒºåˆ†10åˆ†åˆ¶å’Œ40åˆ†åˆ¶
**ç°åœ¨**:
- ä½œæ–‡è¡¨å¢åŠ  `score_system` å­—æ®µ
- è‡ªåŠ¨åˆ¤æ–­åˆ†åˆ¶(åŸå§‹åˆ†â‰¤10 â†’ 10åˆ†åˆ¶)
- è¯„åˆ†æ—¶è‡ªåŠ¨è½¬æ¢

### 5. é…ç½®ç®¡ç† â­
**ä¹‹å‰**: é…ç½®ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
**ç°åœ¨**:
- ç¯å¢ƒå˜é‡ç®¡ç†(.env)
- é…ç½®é›†ä¸­åŒ–(app/config.py)
- æ”¯æŒå¤šç¯å¢ƒé…ç½®

---

## ä¸‹ä¸€æ­¥å·¥ä½œ (éœ€è¦ç»§ç»­å®Œæˆ)

### ğŸ”´ é«˜ä¼˜å…ˆçº§

#### 1. æ‹†åˆ†server.py â†’ APIè·¯ç”±
**ä»»åŠ¡**: å°† `server.py` ä¸­çš„æ¥å£æ‹†åˆ†åˆ° `app/api/` ç›®å½•
```
server.py (22877è¡Œ)
    â†“ æ‹†åˆ†ä¸º
app/api/
â”œâ”€â”€ users.py          # ç”¨æˆ·ç›¸å…³API
â”œâ”€â”€ batches.py        # æ‰¹æ¬¡ç›¸å…³API
â”œâ”€â”€ essays.py         # ä½œæ–‡ç›¸å…³API
â”œâ”€â”€ evaluations.py    # è¯„ä»·ç›¸å…³API
â”œâ”€â”€ scores.py         # è¯„åˆ†ç›¸å…³API
â”œâ”€â”€ prompts.py        # æç¤ºè¯ç›¸å…³API
â””â”€â”€ feedbacks.py      # åé¦ˆç›¸å…³API
```

#### 2. åˆ›å»ºPydantic Schemas
**ä»»åŠ¡**: åœ¨ `app/schemas/` åˆ›å»ºè¯·æ±‚/å“åº”æ¨¡å¼
```
app/schemas/
â”œâ”€â”€ user.py           # ç”¨æˆ·ç›¸å…³Schema
â”œâ”€â”€ batch.py          # æ‰¹æ¬¡ç›¸å…³Schema
â”œâ”€â”€ essay.py          # ä½œæ–‡ç›¸å…³Schema
â”œâ”€â”€ evaluation.py     # è¯„ä»·ç›¸å…³Schema
â”œâ”€â”€ score.py          # è¯„åˆ†ç›¸å…³Schema
â””â”€â”€ prompt.py         # æç¤ºè¯ç›¸å…³Schema
```

#### 3. å®ç°ä¸šåŠ¡é€»è¾‘å±‚
**ä»»åŠ¡**: åœ¨ `app/services/` å®ç°ä¸šåŠ¡é€»è¾‘
```
app/services/
â”œâ”€â”€ ai_service.py          # AIè°ƒç”¨æœåŠ¡(OpenAI)
â”œâ”€â”€ essay_service.py       # ä½œæ–‡ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ score_service.py       # è¯„åˆ†ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ genre_detector.py      # æ–‡ä½“åˆ¤æ–­æœåŠ¡
â””â”€â”€ batch_service.py       # æ‰¹æ¬¡ç®¡ç†æœåŠ¡
```

#### 4. åˆ›å»ºä¸»åº”ç”¨å…¥å£
**ä»»åŠ¡**: åˆ›å»º `app/main.py`
```python
# app/main.py
from fastapi import FastAPI
from app.api import essays, batches, evaluations, scores, prompts

app = FastAPI(title="ä½œæ–‡è¯„åˆ†ç³»ç»Ÿ")

# æ³¨å†Œè·¯ç”±
app.include_router(essays.router, prefix="/api/essays", tags=["ä½œæ–‡"])
app.include_router(batches.router, prefix="/api/batches", tags=["æ‰¹æ¬¡"])
# ... å…¶ä»–è·¯ç”±
```

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§

#### 5. å‰ç«¯é¡µé¢é‡æ„
- ä¿®æ”¹ `templates/index.html` â†’ ä½œæ–‡åˆ—è¡¨é¡µ
- ä¿®æ”¹ `templates/ai-scoring.html` â†’ è¯„åˆ†é¡µé¢
- åˆ›å»º `templates/login.html` â†’ ç™»å½•é¡µé¢
- åˆ›å»º `templates/prompts-management.html` â†’ æç¤ºè¯ç®¡ç†

#### 6. å·¥å…·å‡½æ•°å®ç°
```
app/utils/
â”œâ”€â”€ logger.py         # æ—¥å¿—å·¥å…·
â”œâ”€â”€ validators.py     # éªŒè¯å·¥å…·
â””â”€â”€ converters.py     # åˆ†åˆ¶è½¬æ¢å·¥å…·
```

#### 7. é™æ€æ–‡ä»¶ç»„ç»‡
```
static/
â”œâ”€â”€ css/              # CSSæ ·å¼
â”œâ”€â”€ js/               # JavaScript
â””â”€â”€ images/           # å›¾ç‰‡èµ„æº
```

### ğŸŸ¢ ä½ä¼˜å…ˆçº§

#### 8. æµ‹è¯•è¦†ç›–
```
tests/
â”œâ”€â”€ test_api.py       # APIæµ‹è¯•
â”œâ”€â”€ test_services.py  # æœåŠ¡å±‚æµ‹è¯•
â””â”€â”€ test_models.py    # æ¨¡å‹æµ‹è¯•
```

#### 9. æ€§èƒ½ä¼˜åŒ–
- æ·»åŠ ç¼“å­˜æœºåˆ¶
- ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
- åˆ†é¡µæ€§èƒ½ä¼˜åŒ–

#### 10. æ–‡æ¡£å®Œå–„
- APIæ–‡æ¡£(Swaggerè‡ªåŠ¨ç”Ÿæˆ)
- å¼€å‘è€…æ–‡æ¡£
- ç”¨æˆ·æ‰‹å†Œ

---

## å¦‚ä½•ç»§ç»­å¼€å‘

### æ–¹å¼1: å…ˆæµ‹è¯•æ•°æ®åº“å±‚

```bash
# 1. å®‰è£…ä¾èµ–
pip install -r requirements.txt

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶,å¡«å…¥å®é™…é…ç½®

# 3. åˆå§‹åŒ–æ•°æ®åº“
python scripts/init_db.py

# 4. è¿ç§»æ•°æ®
python scripts/migrate_data.py

# 5. éªŒè¯æ•°æ®
# ä½¿ç”¨MySQLå®¢æˆ·ç«¯æŸ¥çœ‹æ•°æ®æ˜¯å¦æ­£ç¡®è¿ç§»
```

### æ–¹å¼2: ç»§ç»­é‡æ„APIå±‚

```bash
# æŒ‰ç…§"ä¸‹ä¸€æ­¥å·¥ä½œ"ä¸­çš„é¡ºåº
# 1. å…ˆåˆ›å»ºschemas (æ•°æ®éªŒè¯)
# 2. å†åˆ›å»ºservices (ä¸šåŠ¡é€»è¾‘)
# 3. æœ€ååˆ›å»ºapi (è·¯ç”±å¤„ç†)
# 4. åœ¨main.pyä¸­æ³¨å†Œè·¯ç”±
```

---

## å…³é”®è®¾è®¡å†³ç­–

### 1. ä¸ºä»€ä¹ˆä½¿ç”¨SQLAlchemy ORM?
- âœ… ç±»å‹å®‰å…¨
- âœ… è‡ªåŠ¨åŒ–å…³ç³»ç®¡ç†
- âœ… æ”¯æŒå¤šç§æ•°æ®åº“
- âœ… è¿ç§»æ–¹ä¾¿

### 2. ä¸ºä»€ä¹ˆå¼•å…¥æ‰¹æ¬¡(Batch)æ¦‚å¿µ?
- âœ… ç¬¦åˆä¸šåŠ¡é€»è¾‘(ä¸€ä¸ªé¢˜ç›®å¯¹åº”å¤šç¯‡ä½œæ–‡)
- âœ… å‡å°‘æ•°æ®å†—ä½™
- âœ… ä¾¿äºæ‰¹é‡ç®¡ç†
- âœ… æå‡æŸ¥è¯¢æ€§èƒ½

### 3. ä¸ºä»€ä¹ˆä½¿ç”¨åˆ†å±‚æ¶æ„?
- âœ… èŒè´£åˆ†ç¦»,æ˜“äºç»´æŠ¤
- âœ… ä»£ç å¤ç”¨æ€§é«˜
- âœ… æ˜“äºæµ‹è¯•
- âœ… å›¢é˜Ÿåä½œå‹å¥½

### 4. ä¸ºä»€ä¹ˆä¿ç•™server.py?
- â³ ä¿ç•™ä½œä¸ºå‚è€ƒ,æ–¹ä¾¿è¿ç§»é€»è¾‘
- â³ å¾…APIå±‚å®Œæˆåå¯åˆ é™¤

---

## æ•°æ®è¿ç§»ç»Ÿè®¡

### é¢„æœŸè¿ç§»æ•°æ®é‡
- **æ‰¹æ¬¡**: 17ä¸ª
- **ä½œæ–‡**: 1082ç¯‡
- **å¹´çº§**: 3ä¸ª(7/8/9å¹´çº§)
- **æ–‡ä½“**: 2ä¸ª(è®°å™æ–‡/è®®è®ºæ–‡)
- **æç¤ºè¯**: è‹¥å¹²ä¸ª(å–å†³äºJSONæ–‡ä»¶)

### åˆ†åˆ¶åˆ†å¸ƒ(é¢„ä¼°)
- 10åˆ†åˆ¶ä½œæ–‡: å¾…ç»Ÿè®¡
- 40åˆ†åˆ¶ä½œæ–‡: å¾…ç»Ÿè®¡

---

## æŠ€æœ¯æ ˆ

### åç«¯
- **æ¡†æ¶**: FastAPI 0.104.1
- **ORM**: SQLAlchemy 2.0.23
- **æ•°æ®åº“é©±åŠ¨**: PyMySQL 1.1.0
- **é…ç½®ç®¡ç†**: pydantic-settings 2.1.0
- **AI**: OpenAI 1.3.7

### æ•°æ®åº“
- **MySQL**: 8.0+ (æ¨è)
- **å­—ç¬¦é›†**: utf8mb4

### å¼€å‘å·¥å…·
- **Python**: 3.8+
- **è™šæ‹Ÿç¯å¢ƒ**: venv
- **æœåŠ¡å™¨**: uvicorn

---

## æ–‡ä»¶æ¸…å•

### æ–°å»ºæ–‡ä»¶ (23ä¸ª)

#### é…ç½®æ–‡ä»¶ (4ä¸ª)
- `.env.example`
- `.gitignore`
- `requirements.txt` (æ›´æ–°)
- `run.py`

#### åº”ç”¨æ ¸å¿ƒ (2ä¸ª)
- `app/config.py`
- `app/database.py`

#### æ•°æ®åº“æ¨¡å‹ (10ä¸ª)
- `app/models/base.py`
- `app/models/user.py`
- `app/models/grade.py`
- `app/models/genre.py`
- `app/models/prompt.py`
- `app/models/batch.py`
- `app/models/essay.py`
- `app/models/evaluation.py`
- `app/models/score.py`
- `app/models/feedback.py`

#### è„šæœ¬å·¥å…· (2ä¸ª)
- `scripts/init_db.py`
- `scripts/migrate_data.py`

#### æ–‡æ¡£ (3ä¸ª)
- `PROJECT_STRUCTURE.md`
- `DEPLOYMENT_GUIDE.md`
- `RESTRUCTURE_SUMMARY.md` (æœ¬æ–‡æ¡£)

#### __init__.py (6ä¸ª)
- `app/__init__.py`
- `app/models/__init__.py`
- `app/schemas/__init__.py`
- `app/api/__init__.py`
- `app/services/__init__.py`
- `app/utils/__init__.py`
- `tests/__init__.py`

---

## æ€»ç»“

### âœ… å·²å®Œæˆ (ç¬¬ä¸€é˜¶æ®µ)
1. âœ… é¡¹ç›®ç›®å½•é‡ç»„(æ¸…æ™°çš„åˆ†å±‚ç»“æ„)
2. âœ… æ•°æ®åº“æ¨¡å‹è®¾è®¡(9ä¸ªæ¨¡å‹)
3. âœ… é…ç½®ç®¡ç†ç³»ç»Ÿ(ç¯å¢ƒå˜é‡)
4. âœ… æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
5. âœ… æ•°æ®è¿ç§»è„šæœ¬
6. âœ… æ–‡æ¡£å®Œå–„(3ä»½è¯¦ç»†æ–‡æ¡£)

### â³ å¾…å®Œæˆ (ç¬¬äºŒé˜¶æ®µ)
1. â³ APIè·¯ç”±æ‹†åˆ†(server.py â†’ app/api/)
2. â³ Pydantic Schemasåˆ›å»º
3. â³ ä¸šåŠ¡é€»è¾‘å±‚å®ç°
4. â³ ä¸»åº”ç”¨å…¥å£åˆ›å»º

### ğŸ¯ å¾…å®Œæˆ (ç¬¬ä¸‰é˜¶æ®µ)
1. ğŸ¯ å‰ç«¯é¡µé¢é‡æ„
2. ğŸ¯ å·¥å…·å‡½æ•°å®ç°
3. ğŸ¯ æµ‹è¯•è¦†ç›–
4. ğŸ¯ æ€§èƒ½ä¼˜åŒ–

---

**å½“å‰é¡¹ç›®çŠ¶æ€**: æ•°æ®åº“å±‚å®Œæˆ âœ… | APIå±‚å¾…å¼€å‘ â³

**å»ºè®®ä¸‹ä¸€æ­¥**:
1. å…ˆè¿è¡Œæ•°æ®åº“åˆå§‹åŒ–å’Œè¿ç§»è„šæœ¬,éªŒè¯æ•°æ®å±‚
2. ç„¶åå¼€å§‹APIå±‚é‡æ„(schemas â†’ services â†’ api)

**é¢„è®¡å®Œæˆæ—¶é—´**:
- æ•°æ®åº“å±‚: âœ… å·²å®Œæˆ
- APIå±‚: 2-3å¤©
- å‰ç«¯å±‚: 2-3å¤©
- æµ‹è¯•ä¼˜åŒ–: 2-3å¤©

**æ€»è®¡**: çº¦6-9ä¸ªå·¥ä½œæ—¥å¯å®Œæˆå…¨éƒ¨é‡æ„
